# yaml-language-server: $schema=https://taskfile.dev/schema.json

# go

# Only need.
# go compiler
# garble
# go builds for native, wasm, 
# decent LDFLags structure, so we can pull Module as source and build and release using TASK structure. 

# TODO
# Make golang builds a AMP package itself ? might make sense.

version: '3'

vars:
  GO_BIN_NAME: go
  GO_BIN_WHICH:
    sh: 'command -v {{.GO_BIN_NAME}}'
  GO_BIN_VERSION:
    sh: '{{.GO_BIN_NAME}} version'

tasks:
  default:
    desc: go print
    cmds:
      - echo ''
      - echo '- bin'
      - echo 'GO_BIN_NAME:'       {{.GO_BIN_NAME}}
      - echo 'GO_BIN_WHICH:'      {{.GO_BIN_WHICH}}
      - echo 'GO_BIN_VERSION:'    {{.GO_BIN_VERSION}}

      - echo ''
      - echo '- env'

      - echo ''
      - echo '- var'
    silent: true

  bin:
    desc: go build
    cmds:
      - task base:bin
      - echo ''
      - echo 'bin'
      - cd {{.BASE_SRC}} && {{.GO_BIN_NAME}} build -o {{.BASE_BIN}}/{{.BASE_SRC_NAME}}
      - echo ''
    silent: false
   