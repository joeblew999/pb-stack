# https://taskfile.dev

version: "3"

vars:
  BASE_SHELL_OS_NAME:
    #sh: uname -s | tr A-Z a-z
  BASE_SHELL_OS_ARCH:
    #sh: uname -m | tr A-Z a-z
  BASE_GOOS_NAME:
    sh: go env GOOS
  BASE_GOOS_ARCH:
    sh: go env GOARCH

  BASE_HOME: "{{.HOME}}"

  # Our dot folders.
  BASE_SRC: '{{.USER_WORKING_DIR}}'
  
  BASE_BIN: '{{.BASE_SRC}}/{{.DEP}}.bin'
  BASE_DEP: '{{.BASE_SRC}}/{{.DEP}}.dep'
  BASE_PACK: '{{.BASE_SRC}}/{{.DEP}}.pack'

  # Our base helpers
  BASE_AMP_WHICH_BIN_NAME: amp-which
  BASE_AMP_WHICH_BIN_VERSION: latest

  

env:
  # export Path to include our .bin and .dep
  #export PATH:=$(PATH):$(BASE_BIN):$(BASE_DEP)
  # https://github.com/go-task/task/issues/202

  PATH: "{{.BASE_BIN}}:{{.BASE_DEP}}:{{.PATH}}"
    
tasks:
  default:
    desc: base print
    cmds:
      # https://taskfile.dev/reference/environment
      - echo "- task defaults:"
     
      
      # https://taskfile.dev/reference/templating/#special-variables
      - echo ""
      - echo "- task bin"
      - echo "TASK_EXE:"              {{.TASK_EXE}}
      - echo "TASK_VERSION:"          {{.TASK_VERSION}}
      - echo "TASK_TEMP_DIR:"         {{.TASK_TEMP_DIR}}
      - echo ""
      - echo "- task vars"
      - echo "CLI_ARGS:"              {{.CLI_ARGS}}
      - echo "CLI_FORCE:"             {{.CLI_FORCE}}
      - echo ""
      - echo "- task name"
      - echo "TASK:"                  {{.TASK}}
      - echo "TASKFILE:"              {{.TASKFILE}}
      - echo ""
      - echo "- task paths"
      - echo "USER_WORKING_DIR:"      {{.USER_WORKING_DIR}}
      - echo "TASKFILE_DIR:"          {{.TASKFILE_DIR}}
      - echo "TASK_DIR:"              {{.TASK_DIR}}
      - echo "ROOT_TASKFILE:"         {{.ROOT_TASKFILE}}
      - echo ""
      - echo ""
      - echo "BASE_SHELL_OS_NAME:"    {{.BASE_SHELL_OS_NAME}}
      - echo "BASE_SHELL_OS_ARCH:"    {{.BASE_SHELL_OS_ARCH}}
      - echo "BASE_GOOS_NAME:"        {{.BASE_GOOS_NAME}}
      - echo "BASE_GOOS_ARCH:"        {{.BASE_GOOS_ARCH}}
      - echo ""
      - echo "BASE_HOME:"             {{.BASE_HOME}}
      - echo ""
      - echo "BASE_PATH:"             {{.PATH}}
      - echo ""
      - echo "BASE_SRC:"              {{.BASE_SRC}}
      - echo "BASE_BIN:"              {{.BASE_BIN}}
      - echo "BASE_DEP:"              {{.BASE_DEP}}
      - echo "BASE_PACK:"             {{.BASE_PACK}}
      - echo ""
    silent: true


  dep:
    desc: base dep, installs shell level components.
    cmds:
      - echo ""
      - echo "installing base shell tools ..."
      - mkdir -p {{.BASE_BIN}}
      - mkdir -p {{.BASE_DEP}}
      - mkdir -p {{.BASE_PACK}}
      - echo "- base which dep"
      # https://github.com/hairyhenderson/go-which/tree/main/cmd
      - env GOBIN={{.BASE_DEP}} {{.GO_BIN_NAME}} install github.com/hairyhenderson/go-which/cmd/which@{{.BASE_AMP_WHICH_BIN_VERSION}}
      - mv {{.BASE_DEP}}/which {{.BASE_DEP}}/{{.BASE_AMP_WHICH_BIN_NAME}}

  run:
    cmds:
      - '{{.BASE_AMP_WHICH_BIN_NAME}} -h'

